#!/usr/bin/env zsh

setopt localoptions err_return

function send-notification() {
  notify-send 'vimode' "$1"
  zenity --info --text="$1"
}

function normal() {
  xkb-switch -s 'us(vimnormal)'
  # setxkbmap -layout 'us' -variant 'vimnormal'
  xbindkeys -fg ~/.xbindkeysrc.vimnormal.scm
  send-notification 'normal'
}

function insert() {
  xkb-switch -s 'us(viminsert)'
  # setxkbmap -layout 'us' -variant 'viminsert'
  xbindkeys
  send-notification 'insert'
}

if [[ $# -gt 1 ]]; then
  echo 'Usage: vimode [mode]'
  return 1
elif [[ $# -eq 0 ]]; then
  xkb-switch -p
else
  killall xbindkeys 2>&1 > /dev/null || true
  $1
fi
