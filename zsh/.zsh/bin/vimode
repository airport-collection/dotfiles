#!/usr/bin/env zsh

setopt localoptions err_return

function send-notification() {
  notify-send 'vimode' "$1"
}

function normal() {
  # xkb-switch -s 'us(vimnormal)'
  setxkbmap -layout 'us(vimnormal)'
  xbindkeys -fg ~/.xbindkeysrc.vimnormal.scm
  send-notification 'normal'
}

function insert() {
  setxkbmap -layout 'us(viminsert)'
  xbindkeys
  send-notification 'insert'
}

if [[ $# -gt 1 ]]; then
  echo 'Usage: vimode [mode]'
  return 1
elif [[ $# -eq 0 ]]; then
  xkb-switch -p
else
  killall xbindkeys 2>&1 > /dev/null
  $1
fi
