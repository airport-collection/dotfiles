# vim: filetype=zsh sw=2 ts=2 sts=2 et tw=80 foldlevel=0 nospell

: <<=cut
=item Function C<net::ssh>

Utility function that set some env variables by default when connected through ssh.
Arguments will be passed through to ssh

@return NULL
=cut

setopt localoptions nounset err_return

local _ssh_os="$(uname)"
local _ssh_from="$(util::geoinfo city | sed 's/\"//g')"

certstatus -ssh_cert_comment 'corp/normal' || \
  (printf "Certificate expired, getting a new one...
" && zsh::eval 'gcert')
printf "SSHing to remote host %s\n" "$*"
zsh::eval "\ssh $* -t "SSH_OS=${_ssh_os} SSH_FROM=${_ssh_from} zsh -l""
