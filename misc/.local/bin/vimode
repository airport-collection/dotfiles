#!/usr/bin/env zsh

# fpath+=($HOME/.zsh/functions)
# autoload -Uz x::get-active-window-process-name

# local _process
# _process="$(x::get-active-window-process-name)"
# [[ "${_process}" == "/usr/bin/termin" ]] && return 1

function on() {
  touch $LOCK
  notify-send 'vimmode' 'on'
  ln -sf ~/.xbindkeysrc.vim ~/.xbindkeysrc.scm
}

function off() {
  rm $LOCK
  killall xbindkeys 2>&1 > /dev/null
  ln -sf ~/.xbindkeysrc.normal ~/.xbindkeysrc.scm
  notify-send 'vimmode' 'off'
}

function toggle() {
  if is_on; then
    off
  else
    on
  fi
}

function is_on() {
  [[ -f $LOCK ]] && return 0
  return 1
}

local _subcmd="$1"
LOCK=/tmp/vimode.lock
$1
xbindkeys
return 0
